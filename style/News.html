<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœªæ¥30å¹´æ–°é—»å½’æ¡£ (2025-2054)</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f8f9fa;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* é¡¶éƒ¨æ§åˆ¶æ  */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .year-selector-group {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            font-weight: bold;
        }

        select {
            padding: 8px 12px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        .month-btn {
            padding: 8px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #555;
        }

        .month-btn:hover {
            background-color: #f1f1f1;
            border-color: #bbb;
        }

        .month-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
        }

        /* å†…å®¹å±•ç¤ºåŒº */
        #news-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 300px;
        }

        .news-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent-color);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .news-title { margin: 0 0 10px 0; font-size: 1.25em; }
        .news-title a { text-decoration: none; color: var(--primary-color); }
        .news-title a:hover { color: var(--accent-color); }

        .news-meta {
            font-size: 0.85em;
            color: #7f8c8d;
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }

        .status-msg {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1em;
        }
        .error-msg { color: #e74c3c; }
        
        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <h1 style="text-align: center; color: var(--primary-color);">ğŸ—ï¸ å†å²ä¸æœªæ¥æ–°é—»å½’æ¡£</h1>

    <div class="controls">
        <div class="year-selector-group">
            <label for="year-select">é€‰æ‹©å¹´ä»½:</label>
            <select id="year-select" disabled>
                <option>åŠ è½½ä¸­...</option>
            </select>
        </div>

        <div class="months-grid" id="month-container">
            </div>
    </div>

    <div id="news-container">
        <div class="status-msg">
            <div class="spinner"></div>
            æ­£åœ¨åŒæ­¥è¿œç¨‹é…ç½®æ–‡ä»¶...
        </div>
    </div>

    <script>
        // ============================================
        // æ ¸å¿ƒé…ç½®ï¼šè¿œç¨‹ Config æ–‡ä»¶çš„åœ°å€
        // ============================================
        const REMOTE_CONFIG_URL = 'https://raw.githubusercontent.com/moodHappy/HelloWorld/refs/heads/master/Notes/News.js';

        // DOM å…ƒç´ 
        const yearSelect = document.getElementById('year-select');
        const monthContainer = document.getElementById('month-container');
        const newsContainer = document.getElementById('news-container');

        // ç¬¬ä¸€æ­¥ï¼šåŠ è½½è¿œç¨‹é…ç½®æ–‡ä»¶
        function loadRemoteConfig() {
            // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜ï¼Œä¿è¯ä½ ä¿®æ”¹ GitHub åè¿™é‡Œèƒ½ç«‹é©¬ç”Ÿæ•ˆ
            const timestamp = new Date().getTime();
            // ä½¿ç”¨ä»£ç†è·å– JS å†…å®¹
            const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(REMOTE_CONFIG_URL) + '&t=' + timestamp;

            fetch(proxyUrl)
                .then(response => {
                    if (!response.ok) throw new Error("æ— æ³•ä¸‹è½½é…ç½®æ–‡ä»¶");
                    return response.text();
                })
                .then(scriptContent => {
                    // åˆ›å»ºä¸€ä¸ª Blob å¯¹è±¡æ¥æ¨¡æ‹Ÿæœ¬åœ°è„šæœ¬
                    const blob = new Blob([scriptContent], { type: 'application/javascript' });
                    const url = URL.createObjectURL(blob);
                    
                    // åŠ¨æ€æ’å…¥è„šæœ¬
                    const script = document.createElement('script');
                    script.src = url;
                    script.onload = () => {
                        console.log("é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸ");
                        initApp(); // è„šæœ¬åŠ è½½å®Œåï¼Œå¯åŠ¨åº”ç”¨
                        URL.revokeObjectURL(url); // é‡Šæ”¾å†…å­˜
                    };
                    script.onerror = () => {
                        throw new Error("é…ç½®æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥ News.js è¯­æ³•");
                    };
                    document.head.appendChild(script);
                })
                .catch(error => {
                    console.error(error);
                    newsContainer.innerHTML = `
                        <div class="status-msg error-msg">
                            <h3>âš ï¸ é…ç½®åŠ è½½å¤±è´¥</h3>
                            <p>${error.message}</p>
                            <p>è¯·æ£€æŸ¥ GitHub é“¾æ¥æ˜¯å¦æ­£ç¡®ã€‚</p>
                        </div>
                    `;
                });
        }

        // ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–åº”ç”¨ (Config åŠ è½½æˆåŠŸåæ‰§è¡Œ)
        function initApp() {
            if (typeof NewsConfig === 'undefined') {
                newsContainer.innerHTML = '<div class="status-msg error-msg">é”™è¯¯ï¼šNews.js å·²åŠ è½½ä½† NewsConfig å¯¹è±¡ä¸å­˜åœ¨ã€‚</div>';
                return;
            }

            // å¯ç”¨ä¸‹æ‹‰æ¡†
            yearSelect.disabled = false;
            yearSelect.innerHTML = '';

            populateYears();
            
            // é»˜è®¤åŠ è½½é€»è¾‘ï¼šä¼˜å…ˆåŠ è½½å½“å‰æ—¶é—´ï¼Œå¦‚æœæ˜¯æœªæ¥åˆ™å›é€€åˆ° Config èµ·å§‹æ—¶é—´
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1;
            
            // é»˜è®¤é€‰ä¸­ Config ä¸­çš„ç¬¬ä¸€å¹´ï¼Œæˆ–è€…å½“å‰å¹´ä»½ï¼ˆå¦‚æœåœ¨èŒƒå›´å†…ï¼‰
            let defaultYear = NewsConfig.startYear;
            if (currentYear >= NewsConfig.startYear && currentYear < NewsConfig.startYear + NewsConfig.totalYears) {
                defaultYear = currentYear;
            }

            // è®¾ç½®ä¸‹æ‹‰æ¡†å¹¶è§¦å‘åŠ è½½
            yearSelect.value = defaultYear;
            loadMonthsForYear(defaultYear);

            // è‡ªåŠ¨ç‚¹å‡»å¯¹åº”æœˆä»½
            const monthToClick = (defaultYear === currentYear) ? currentMonth : 12;
            const targetBtn = document.querySelector(`button[data-month="${monthToClick}"]`);
            if (targetBtn) {
                targetBtn.click();
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”æœˆä»½ï¼Œç‚¹12æœˆ
                const lastBtn = document.querySelector(`button[data-month="12"]`);
                if(lastBtn) lastBtn.click();
            }
        }

        // å¡«å……å¹´ä»½
        function populateYears() {
            const start = NewsConfig.startYear;
            const end = start + NewsConfig.totalYears;

            for (let y = start; y < end; y++) {
                const option = document.createElement('option');
                option.value = y;
                option.text = `${y}å¹´`;
                yearSelect.appendChild(option);
            }

            yearSelect.addEventListener('change', (e) => {
                loadMonthsForYear(parseInt(e.target.value));
            });
        }

        // ç”Ÿæˆæœˆä»½æŒ‰é’®
        function loadMonthsForYear(year) {
            monthContainer.innerHTML = '';
            
            for (let m = 1; m <= 12; m++) {
                const btn = document.createElement('button');
                btn.className = 'month-btn';
                btn.innerText = `${m}æœˆ`;
                btn.dataset.month = m;
                
                btn.onclick = () => {
                    document.querySelectorAll('.month-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    fetchNews(year, m);
                };

                monthContainer.appendChild(btn);
            }
        }

        // è·å–å¹¶è§£ææ–°é—»
        function fetchNews(year, month) {
            // ä½¿ç”¨è¿œç¨‹ Config ä¸­çš„é€»è¾‘è·å– URL
            const targetUrl = NewsConfig.getUrl(year, month);
            
            newsContainer.innerHTML = `
                <div class="status-msg">
                    <div class="spinner"></div>
                    æ­£åœ¨è¯»å–æ¡£æ¡ˆ: ${year}-${month.toString().padStart(2,'0')} ...
                </div>`;

            // ä½¿ç”¨ä»£ç†è·å– Markdown
            const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(targetUrl);

            fetch(proxyUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Github 404 Not Found');
                    return response.text();
                })
                .then(text => {
                    if (!text.trim()) throw new Error('å†…å®¹ä¸ºç©º');
                    const items = parseMarkdown(text);
                    renderItems(items);
                })
                .catch(error => {
                    let msg = `æœªæ‰¾åˆ° ${year}å¹´${month}æœˆ çš„å½’æ¡£ã€‚`;
                    // åªæœ‰å½“è¿™ä¸ªæœˆç¡®å®æ‰‹åŠ¨é…ç½®äº†é“¾æ¥ï¼Œæ‰æ˜¾ç¤ºé“¾æ¥é”™è¯¯ï¼Œå¦åˆ™æ˜¾ç¤ºæœªä¸Šä¼ 
                    if (NewsConfig.manualOverrides[`${year}-${month.toString().padStart(2,'0')}`]) {
                         msg = `æ— æ³•åŠ è½½æ‚¨é…ç½®çš„é“¾æ¥ã€‚`;
                    }
                    
                    newsContainer.innerHTML = `
                        <div class="status-msg">
                            ${msg}<br>
                            <small style="opacity:0.5; font-size: 0.8em">(${error.message})</small>
                        </div>`;
                });
        }

        // Markdown è§£æé€»è¾‘
        function parseMarkdown(text) {
            const lines = text.split('\n');
            const items = [];
            let currentItem = null;

            lines.forEach(line => {
                line = line.trim();
                const titleMatch = line.match(/^### \[(.*?)\]\((.*?)\)/);
                if (titleMatch) {
                    if (currentItem) items.push(currentItem);
                    currentItem = { title: titleMatch[1], link: titleMatch[2], date: '', id: '' };
                } else if (currentItem) {
                    const dateMatch = line.match(/^- \*\*Date\*\*: (.*)/);
                    if (dateMatch) currentItem.date = dateMatch[1];
                    const idMatch = line.match(/^- \*\*ID\*\*: (.*)/);
                    if (idMatch) currentItem.id = idMatch[1];
                }
            });
            if (currentItem) items.push(currentItem);
            return items;
        }

        // æ¸²æŸ“åˆ—è¡¨
        function renderItems(items) {
            newsContainer.innerHTML = '';
            if (items.length === 0) {
                newsContainer.innerHTML = '<div class="status-msg">è§£ææˆåŠŸï¼Œä½†æ²¡æœ‰æ¡ç›®ã€‚</div>';
                return;
            }
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'news-item';
                div.innerHTML = `
                    <h2 class="news-title"><a href="${item.link}" target="_blank">${item.title}</a></h2>
                    <div class="news-meta">
                        <span>ğŸ“… ${item.date || 'æœªçŸ¥æ—¥æœŸ'}</span>
                        <span>ğŸ†” ${item.id || 'N/A'}</span>
                    </div>
                `;
                newsContainer.appendChild(div);
            });
        }

        // å¯åŠ¨ç¨‹åº
        loadRemoteConfig();

    </script>
</body>
</html>
